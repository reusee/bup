<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="bootstrap.min.css">
    <link rel="stylesheet" href="bootstrap-theme.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="jquery-2.1.4.min.js"></script>
    <script src="bootstrap.min.js"></script>

    <script src="riot+compiler.min.js"></script>

    <!--
    <script src="react.js"></script>
    <script src="jsx.js"></script>
    -->

  </head>
  <body>
    <div class="container">
      <div class="row">
        <a name="top"></a>
        <div class="col-md-6">
          <entries id="left"></entries>
        </div>
        <div class="col-md-6">
          <entries id="right"></entries>
        </div>
        <nav class="navbar navbar-default navbar-fixed-bottom">
          <div class="container">
            <div class="collapse navbar-collapse">
              <ul class="nav navbar-nav navbar-right">
                <li><button class="btn btn-default navbar-btn" onClick="reload()">Refresh</button></li>
                <li><a href="#top">Top</a></li>
              </ul>
            </div>
          </div>
        </nav>
      </div>
    </div>

    <script>
    var reloads = [];
    var reload = function() {
      for (var i in reloads) { reloads[i]() }
    };
    </script>

    <script type="riot/tag">
    <entries>
      <div class="entry" each={data}>
        <p>
          <button class="btn btn-primary btn-sm" onClick={parent.click}>Mark</button>
          <a href={'go?id=' + id} target="_blank" class="title" onClick={parent.click}>{title}</a>
        </p>
        <img src={image} class="img-rounded img-responsive"></img>
      </div>
      var self = this
      loadData() {
        $.ajax({
          url: opts.url,
          dataType: 'json',
          cache: false,
          success: function(data) {
            self.data = data;
            self.update();
          }.bind(self),
          error: function(xhr, status, err) {
            console.error(opts.url, status, err.toString());
          }.bind(self)
        });
      };
      self.on('mount', function() {
        self.loadData();
        setInterval(self.loadData, 8000);
        reloads.push(self.loadData);
      });
      click(event) {
        $.ajax({
          url: 'mark?id=' + event.item.id,
          dataType: 'json',
          cache: false,
          success: function(data) {
            reload();
          },
          error: function(xhr, status, err) {
            console.error(opts.url, status, err.toString());
          }
        });
      };
    </entries>
    </script>

    <script>
    riot.mount('#left', {url: "newest.json"});
    riot.mount('#right', {url: "recently.json"});
    </script>

  </body>
</html>
